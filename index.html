<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>D3.js Force Layout Example with Interactivity, Zoom, and Drag</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    .node {
      cursor: pointer;
      stroke: #fff;
      stroke-width: 1.5px;
    }

    .link {
      stroke: #999;
      stroke-opacity: 0.6;
    }

    .label {
      font-size: 12px;
      fill: #000;
      pointer-events: none;
    }

    .highlight {
      stroke: #f00 !important;
      stroke-width: 2.5px !important;
    }
  </style>
</head>

<body>
<h1>FORCE LAYOUT VISUALISATION</h1>
  <svg width="2900" height="2600"></svg>

  <script>
    d3.json("data.json").then(function (data) {
      
      var color = d3.scaleOrdinal(d3.schemeCategory10)
        .domain(data.nodes.map(function (d) { return d.country; }));

      var radius = d3.scaleSqrt()
        .domain(d3.extent(data.nodes, function (d) { return d.citations; }))
        .range([1, 30]);

      var simulation = d3.forceSimulation(data.nodes)
        .force("link", d3.forceLink(data.links).id(function (d) { return d.id; }))
        .force("charge", d3.forceManyBody())
        .force("center", d3.forceCenter(400, 300))
        .force("collide", d3.forceCollide().radius(function (d) { return d.citations; }));

      var links = d3.select("svg")
        .selectAll(".link")
        .data(data.links)
        .enter()
        .append("line")
        .attr("class", "link")

      var nodes = d3.select("svg")
        .selectAll(".node")
        .data(data.nodes)
        .enter()
        .append("circle")
        .attr("class", "node")
        .attr("r", function (d) { return radius(d.citations); })
        .attr("fill", function (d) { return color(d.country); })
        .on("mouseover", function (d) { highlightNode(d); })
        .on("mouseout", function (d) { unhighlightNode(d); });

      var labels = d3.select("svg")
        .selectAll(".label")
        .data(data.nodes)
        .enter()
        .append("text")
        .attr("class", "label")
        .attr("font-family", "sans-serif")
        .attr("font-size", "12px")
        .attr("text-anchor", "middle")
        .attr("fill", "#000")
        .text(function (d) { return d.fauthor; });

      simulation.on("tick", function () {
        links
          .attr("x1", function (d) { return d.source.x; })
          .attr("y1", function (d) { return d.source.y; })
          .attr("x2", function (d) { return d.target.x; })
          .attr("y2", function (d) { return d.target.y; });

        nodes
          .attr("cx", function (d) { return d.x; })
          .attr("cy", function (d) { return d.y; });

        labels
          .attr("x", function (d) { return d.x; })
          .attr("y", function (d) { return d.y; })
          .attr("text-anchor", "middle")
          .attr("alignment-baseline", "central");
      });
      
      var drag = d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended);
      
      drag(nodes);

      var zoom = d3.zoom()
        .scaleExtent([0.5, 10])
        .on("zoom", zoomed);

      zoom(d3.select("svg"));

      function dragstarted(event, d) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
      }

      function dragged(event, d) {
        d.fx = event.x;
        d.fy = event.y;
      }

      function dragended(event, d) {
        if (!event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
      }

      function zoomed(event) {
        d3.select("svg").attr("transform", event.transform);
      }

      function highlightNode(d) {
        links
          .classed("highlight", function (l) { return d === l.source || d === l.target; });
        nodes
          .classed("highlight", function (n) { return d === n; });
        labels
          .classed("highlight", function (l) { return d === l; });
      }

      function unhighlightNode() {
        links
          .classed("highlight", false);
        nodes
          .classed("highlight", false);
        labels
          .classed("highlight", false);
      }
    });
  </script>

</body>

</html>